# 应用层

## DNS

我们都知道，在互联网中通过唯一的 ip 地址可以找到对应的主机，但是 ip 地址是.十进制组成的，这么多的主机，很难去
记忆这么多的 ip 地址，因此，直接靠 ip 地址去访问主机比较麻烦，就像你要找一个人，你要把所有人的身份证号码都背下来一样麻烦。我们如果要找一个人一般可以通过公安局，去那它的名字查到对应的身份证，然后进行查找，公安局就是维护名字->身份证号码的系统。在计算机领域也是一样，我们通过域名来表示一个 ip 地址，然后通过一个域名解析系统也就是 DNS 解析里维护域名->DNS 的解析，通过 DNS 解析这到对应的 ip 地址，从而找到对应的主机。

### 域名

![域名](https://ftp.bmp.ovh/imgs/2021/03/96bb22fc11942e53.png)

### DNS 服务器

DNS 服务器就是用来将域名解析成对应的 ip 地址，由于互联网中主机非常多，因此 DNS 服务器肯定也不止一台，DNS 服务器同样根据域名的分类进行分类，分成了根域名服务器，顶级域名服务器和权限域名服务器。另外，还有本地域名服务器。

域名服务器：

- 根域名服务器：只有顶级域名服务器的 ip 地址信息。
- 顶级域名服务器：负责管理该顶级域名服务器注册的所有二级域名。比如找到了.com 服务器，就可以找到所有的 xxx.com 服务器。
- 权限域名服务器:负责一个区的域名服务器。
- 本地域名服务器：当一个主机发出 DNS 查询请求时，这个查询请求报文就发给本地域名服务器。

### 域名解析过程

域名解析过程主要有两种方式，一种是**递归查询**，一种是**迭代查询**。

#### 递归查询

递归查询就是靠别人：比如向本地服务器查询，本地服务器没有，就寻求根服务器的帮助，根服务器找到顶级域名服务器，如果域名还没有解析完成，那么顶级域名服务器就需要靠权限域名服务器的帮助，最终依次下来解析整个域名。
主机 -> 本地域名服务器 -> 根域名服务器 -> 顶级域名服务器 ->权限域名服务器。最终返回 ip 地址就是相反的顺序，从
权限域名服务器得到的->顶级域名服务器 -> 根域名服务器 -> 本地域名服务器 ->主机

以`www.kaoyan.com.`域名为例：

1. 主机访问这个网址时，首先向本地域名服务器(一般是离主机最近的域名服务器，又称为默认域名服务器)发送请求，如果是第一次访问，本地域名服务器没有当前域名的 DNS，那么它就会向根域名发送查询：
2. 根域名服务器只有顶级域名服务器的 ip 地址，这时候它就会把 com(当前域名的顶级域名)的 ip 地址发送给权限域名服务器。
3. 权限域名服务器会摘到对应的区比如`www.kaoyan`这个区。然后找到对应的服务器。
4. 再按照相反的顺序返回 ip 地址。

#### 迭代查询

**迭代查询就是靠自己**（这里的自己就是本地域名服务器）。
主机 -> 本地域名服务器 -> 根域名服务器

1. 主机访问这个网址时，首先向本地域名服务器(一般是离主机最近的域名服务器，又称为默认域名服务器)发送请求，如果是第一次访问，本地域名服务器没有当前域名的 DNS，那么它就会向根域名发送查询，顶级域名还没有查询到，但是它会告诉你你去找 com 这个顶级域名进行查找。
2. 本地域名就会去找相对应的顶级域名服务器，如果顶级域名服务器也不知道域名对应的 ip 地址，那么他就会告诉本地域名服务器去找哪个权限域名服务器。
3. 本地域名继续向权限域名服务器进行查找。知道找到为止。

![域名解析的两种方式](https://ftp.bmp.ovh/imgs/2021/03/6abe15ac32f25858.png)
如上图所示，我们可以发现要查找一个服务器的 ip 地址是非常繁琐的一件事，需要经历多次递归和迭代。因此引入了高速缓存。

#### 高速缓存

将访问过的网站的域名和 DNS 解析信息存储在本地域名服务器中，当再次访问这个域名时只需要从本地域名服务器进行获取即可。

1. 如果直接有这个域名的完整的 DNS，那么可以直接返回。
2. 如果找不到完整的 ip 地址，但是本地域名服务器保存了.com 顶级域名服务器的地址，那么也可以减少本地域名服务器向跟服务器发送的请求。
3. 同理它还可以保存权限域名服务器的信息，减少向顶级域名的请求。

4. 为了保持高速缓存的信息正确，会对本地域名服务器定时更新。
5. 处理对本地域名服务器进行 DNS 缓存，主机也会在第一次启动的时候，向本地域名服务器发送请求，获取域名和对应的 ip 信息的数据库，存储在主机的高速缓存中。因此，要访问一个网站，要经过的顺序是：
   本机的高速缓存查找 DNS 信息 -> 本地服务器的高速缓存查找 DNS 信息，然后才是向根服务器,顶级域名服务器一级权限域名服务器发起 DNS 解析请求。
